---
layout: default
title: Understanding the Color in Game Boy Color
description: Where do I start?
---

[back](/)

# Post #2 - Understanding the *'Color'* in Game Boy Color

From coding for the classig Game Boy (DMG), I had a somewhat good understanding on how tiles, backgrounds, sprites, the pallette and all that works,
but to make the next step on utilizing the GBC, I had three problems right from the start:

- I couldn't get the assembler to produce a usable cartridge file (even if I just copy-pasted a very simple cartridge)
- First, I had only used [GBDK](https://github.com/gbdk-2020/gbdk-2020) so far, which does most of the musclework for you in highlevel C and so I had to find a good source of example code in assembly
- I did not quite understand on how the GBC color pallettes work

In the end it turned out that things are way easier than I thought. The problem was mainly in front of the screen and I had just made some wrong assumptions in the first place, but I'll describe my situation in the next few sentences.

## The Game Boy Color *'Mode'*

I knew that the DMG and GBC are very much the same system, at least when it comes to assembler and that the GBC is capable of running old DMG games, so I started my journey at the [GB ASM Tutorial](https://gbdev.io/gb-asm-tutorial/) from gbdev.io.
The `Hello World!` example they use is pretty straight forward and should work right away, unfortunately I was unable to get it running on my system. All I got was a white screen in Emulicious.

![Nothing to see :()](media/p1_1.png)

At some point I did exactly what was written in the tutorial - including the command line commands - and to my surprise, ended up with a working cartridge.
So I must have definitely missed out on something! I then copy pasted the exact assembler to my project and... again, a white screen!
Ok, so the only difference now were the flags of the build commands. I commented out every single one and eventually found the one that was causing me all this trouble: `--color-only` or short `-C` for **rgbfix**.
After removing it, I was greeted with a nice working cartridge... cool! But whats the issue here?
When I wrote the makefile, I thought that this flag could cause no harm since I was only going to support the GBC anyways, but this assumption seems to be wrong. 
So maybe let's have a look on what will change in the final cartridge when I use this flag.
Interestingly the only thing that changes is a single byte at file-offset 0x143: With `-C` it is 0xC0 and without it is 0x00.
Well... looking back at the [descripton of rgbfix](https://rgbds.gbdev.io/docs/v0.6.0/rgbfix.1/) that's exactly what is supposed to happen. 
But whats the deal with that?
Well, to make a long story short, there are different boot roms for the DMG and GBC. When you run on a GBC (or tell the emulator to act as one), it checks for this particular byte in the header and sets the GBC-pallettes to all white. Moreover it will enable the DMG compatibility mode if the value is 0x80 (you can set this by using flag `--color-compatible` or `-c`).

You can read more on that in the [Pan Docs](https://gbdev.io/pandocs/Power_Up_Sequence.html#compatibility-palettes).

So finally that means if you set the cartridge byte 0x143 to 0x80 or 0xC0 it runs in DMG compatibility mode or in GBC-only mode, but in both cases gets its pallette data from the GBC palletes which - at that point - are set to white and thus a white screen should be normal. A value of 0x00 seems to make no sense, but I guess in that case most emulators fall back to normal DMD operation and thus the DMG pallette works in that case.
Anyways, I should be able to see the tiles again, if I simply set the pallette color to anything else, right? Time to dive into the GBC pallettes.



[back](/)
